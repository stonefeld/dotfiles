#!/bin/bash

pgrep -x mpd || mpd
options="Play/Pause\\nPrevious song\\nNext song\\nChange song\\nAdd song\\nLoad playlist"
current_song=$(mpc status | head -n 1)

echo "$current_song" | egrep '^volume:.*$' &>/dev/null
[ "$?" -eq 0 ] || now_playing="Now playing: $current_song"

choice=$(printf "$options" | dmenu -i -h 25 -p "$now_playing")
[ -z "$choice" ] && exit

case "$choice" in
	Play/Pause)     mpc toggle;;

	Previous\ song) mpc prev;;

	Next\ song)     mpc next;;

	Change\ song)   song="$(mpc playlist | dmenu -l 20 -i)"
	                [ -z "$song" ] && exit
	                mpc play "$(mpc playlist | sed "/^$song/q" | wc -l)";;

	Add\ song)      song="$(mpc listall | dmenu -l 20 -i)"
	                [ -z "$song" ] && exit
	                mpc add "$song";;

	Load\ playlist) playlist=$(ls ${MUSIC_FOLDER:-$HOME/music} | dmenu -l 20 -i)
	                [ -z "$playlist" ] && exit
	                mpc clear
	                mpc add "$playlist"
	                mpc play;;
esac
