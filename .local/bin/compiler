#!/bin/bash

file=$1
dir="${file%/*}"
base="${file%.*}"
ext="${file##*.}"

cd "$dir" || exit

compile_tex() {
	command="pdflatex"
	$command --output-directory="$dir" "$base" &&
	grep -qi "addbibresource" "$file" &&
	biber --input-directory "$dir" "$base" &&
	$command --output-directory="$dir" "$base"
	$command --output-directory="$dir" "$base"
}

compile_md() {
    # pandoc \
    #     --verbose \
    #     --pdf-engine=xelatex \
    #     --highlight-style=zenburn \
    #     --variable graphics \
    #     --variable 'geometry:margin=1in' \
    #     "$base".md -s \
    #     --output "$base".pdf
    pandoc \
        "$base".md \
        -o "$base".pdf \
        --from markdown \
        --template $HOME/.local/share/templates/latex/template.tex \
        --pdf-engine xelatex \
        --listings \
        --verbose
}

compile_c() {
	[ -f "getnum.c" ] && SRC="getnum.c"
	gcc -std=c99 -pedantic -Wall -o "$base" "$file" $SRC -lm
}

case "$ext" in
	tex) compile_tex;;
    md)  compile_md;;
	c)   compile_c;;
esac
