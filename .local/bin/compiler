#!/bin/bash

file=$1
dir="${file%/*}"
base="${file%.*}"
ext="${file##*.}"

cd "$dir" || exit

compile_tex() {
	command='pdflatex'
	$command --output-directory="$dir" "$base" && \
		grep -qi 'addbibresource' "$file" && \
		biber --input-directory "$dir" "$base" && \
		$command --output-directory="$dir" "$base"
	$command --output-directory="$dir" "$base"
}

compile_md() {
	pandoc \
		"$base".md \
		-s -o "$base".pdf \
		-V 'geometry:margin=1in' \
		--highlight-style=zenburn \
		--pdf-engine=xelatex \
		--verbose
}

case "$ext" in
	tex) compile_tex;;
	md)  compile_md;;
esac
