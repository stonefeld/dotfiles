#!/bin/bash

file=$1
dir="${file%/*}"
base="${file%.*}"
ext="${file##*.}"

cd "$dir" || exit

compile_tex() {
	command="pdflatex"
	$command --output-directory="$dir" "$base" &&
	grep -qi "addbibresource" "$file" &&
	biber --input-directory "$dir" "$base" &&
	$command --output-directory="$dir" "$base"
	$command --output-directory="$dir" "$base"
}

compile_c() {
	[ -f "getnum.c" ] && SRC="getnum.c"
	gcc -std=c99 -pedantic -Wall -o "$base" "$file" $SRC -lm
}

case "$ext" in
	tex) compile_tex;;
	c)   compile_c;;
esac
