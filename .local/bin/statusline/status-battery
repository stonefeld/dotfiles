#!/bin/sh

COLORED_EMOJIS=$1

messid="90909090"
messapp="system"

batper=$(cat /sys/class/power_supply/BAT0/capacity)
bat=$(( $batper / 10 ))

[ "$COLORED_EMOJIS" = true ] && icon="ðŸ”‹" || icon="?"

if [ ! "$COLORED_EMOJIS" = true ]; then
    case $bat in
        "0")  icon="ï‰„ ";;
        "1")  icon="ï‰„ ";;
        "2")  icon="ï‰ƒ ";;
        "3")  icon="ï‰ƒ ";;
        "4")  icon="ï‰‚ ";;
        "5")  icon="ï‰‚ ";;
        "6")  icon="ï‰‚ ";;
        "7")  icon="ï‰ ";;
        "8")  icon="ï‰ ";;
        "9")  icon="ï‰€ ";;
        "10") icon="ï‰€ ";;
    esac
fi

char=$(cat /sys/class/power_supply/BAT0/status)
if [ "$char" = "Full" ] || [ "$char" = "Charging" ]; then
    [ "$COLORED_EMOJIS" = true ] && echo "ðŸ”Œ $batper%" || echo "$icon ïƒ§ $batper%"
else
    if [ "$batper" -le 10 ]; then
        rm -f /tmp/batwarning
        if [ ! -f /tmp/batcritical ]; then
            echo 1 > /tmp/batcritical
            dunstify -a $messapp -r $messid -i battery-empty "Battery critical" "Your battery level is 10%, please consider charging"
            canberra-gtk-play -i dialog-warning
        fi
    elif [ "$batper" -le 20 ]; then
        rm -f /tmp/batcritical
        if [ ! -f /tmp/batwarning ]; then
            echo 1 > /tmp/batwarning
            dunstify -a $messapp -r $messid -i battery-low "Battery warning" "Your battery level is 20%, please consider charging"
            canberra-gtk-play -i dialog-warning
        fi
    else
        rm -f /tmp/batcritical
        rm -f /tmp/batwarning
    fi
    echo "$icon $batper%"
fi
