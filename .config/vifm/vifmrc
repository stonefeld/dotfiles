"        _  __
" __   _(_)/ _|_ __ ___  _ __ ___
" \ \ / / | |_| '_ ` _ \| '__/ __|
"  \ V /| |  _| | | | | | | | (__
"   \_/ |_|_| |_| |_| |_|_|  \___|

" ========== OPTIONS ========== "
set vicmd=$EDITOR
set syscalls
set trash
set history=100
set undolevels=100
set nofollowlinks
set sortnumbers
set sort=+iname
set vimhelp
set norunexec
set wildmenu
set wildstyle=popup
set tuioptions=p
set nowrap
set suggestoptions=normal,visual,view,delay:0,keys,marks,registers
set ignorecase
set smartcase
set nohlsearch
set incsearch
set scrolloff=3
set viewcolumns=-{name}..,6{}
set timefmt=%Y-%m-%d\ %H:%M
set statusline=" %1*%A%* %u %g %s %d%=%{system('cat ~/.config/vifm/dirsum')} sum, %a free  %l/%S  %P "
set rulerformat=
set dirsize=nitems
set milleroptions=lsize:1,csize:2,rsize:3,rpreview:all
set millerview
set quickview
set previewoptions+=graphicsdelay:0
" set vifminfo=dhistory,savedirs,chistory,state,tui,shistory,phistory,fhistory,dirstack,registers,bookmarks,bmarks
set dotdirs=
set dotfiles
if !has('win')
  set slowfs=curlftpfs
endif

" ========== COLORS ========== "
colorscheme Custom

" ========== AUTOCOMMANDS ========== "
" Re-exectue dirsum command on every directory changed
au DirEnter '*' !dirsum &
au DirEnter '.*' !dirsum &
only

" ========== CONFIGURATIONS ========== "
" Get bookmarks and icons
source ~/.config/vifm/bookmarks.vifm
source ~/.config/vifm/icons.vifm

" ========== COMMANDS ========== "
" The following macros can be used in a command
" %a is replaced with the user arguments.
" %c the current file under the cursor.
" %C the current file under the cursor in the other directory.
" %f the current selected file, or files.
" %F the current selected file, or files in the other directory.
" %b same as %f %F.
" %d the current directory name.
" %D the other window directory name.
" %m run the command in a menu window
command! df df -h %m 2> /dev/null
command! du du -h . %m 2> /dev/null
command! reload :write | restart full
command! zip zip -r %f.zip %f
command! tgz tar -czf %f.tar.gz --verbose %f
command! tar tar -cf %f.tar --verbose %f
command! ex ex %f
command! run !! ./%f
command! dragon dragon-drag-and-drop -a -x %f
command! dragdl dlfile
command! sw setbg %c

" ========== MAPPINGS ========== "
nnoremap e :edit<cr>
nnoremap E :!
nnoremap s :shell<cr>
nnoremap S :sort<cr>

nnoremap w :view<cr>
vnoremap w :view<cr>gv

nnoremap I cw<c-a>
nnoremap cc cw<c-u>
nnoremap A cw<c-e>
nnoremap aa cW

nnoremap <wait> ;f :touch<space>""<left>
nnoremap <wait> ;d :mkdir<space>""<left>

nnoremap <wait> xx :ex<cr>
nnoremap <wait> xz :zip<cr>
nnoremap <wait> xt :tar<cr>
nnoremap <wait> xg :tgz<cr>

nnoremap <silent> <c-t> :tabnew<cr>
nnoremap <silent> <c-k> :tabc<cr>
nnoremap <silent> <c-l> :tabn<cr>
nnoremap <silent> <c-h> :tabp<cr>

nnoremap <wait> ,w :set wrap!<cr>

nnoremap qq :q<cr>

nnoremap J 5j
nnoremap K 5k

nmap dr :dragon<cr>
vmap dr :dragon<cr>
nmap dl :dragdl<cr>

" Interaction with system clipboard
if has('win')
    " Yank current directory path to Windows clipboard with forward slashes
    nnoremap yp :!echo %"d:gs!\!/! %i | clip<cr>
    " Yank path to current file to Windows clipboard with forward slashes
    nnoremap yf :!echo %"c:gs!\!/! %i | clip<cr>
elseif executable('xclip')
    " Yank current directory path into the clipboard
    nnoremap yd :!echo %d | xclip %i<cr>
    " Yank current file path into the clipboard
    nnoremap yf :!echo %c:p | xclip %i<cr>
elseif executable('xsel')
    " Yank current directory path into primary and selection clipboards
    nnoremap yd :!echo -n %d | xsel --input --primary %i &&
                \ echo -n %d | xsel --clipboard --input %i<cr>
    " Yank current file path into into primary and selection clipboards
    nnoremap yf :!echo -n %c:p | xsel --input --primary %i &&
                \ echo -n %c:p | xsel --clipboard --input %i<cr>
endif

" ========== FILETYPES ========== "
" Open files with the program specified on each system
filetype *
      \ xdg-open %c 2>/dev/null &

" Try to highlight known text files, otherwise just print them
fileviewer <text/*>
      \ highlight -O ansi -s base16/bright %c,
      \ cat %c,

" Try to format a json file
fileviewer *.json
      \ python -m json.tool %c,
      \ file %c,

" Try to preview the pdf
fileviewer *.pdf
      \ vifmimg pdf %px %py %pw %ph %c
      \ %pc
      \ vifmimg clear,
      \ pdfinfo %c,
      \ file %c,

" Try to preview the djvu file
fileviewer *.djvu
      \ vifmimg djvu %px %py %pw %ph %c
      \ %pc
      \ vifmimg clear,
      \ file %c,

" Try to preview the epub
fileviewer *.epub
      \ vifmimg epub %px %py %pw %ph %c
      \ %pc
      \ vifmimg clear,
      \ file %c,

" Try to preview the video thumbnail
fileviewer <video/*>
      \ vifmimg video %px %py %pw %ph %c
      \ %pc
      \ vifmimg clear,
      \ ffprobe -pretty %c 2>&1
      \ file %c,

" Try to preview the picture
fileviewer <image/*>
      \ vifmimg draw %px %py %pw %ph %c
      \ %pc
      \ vifmimg clear,
      \ identify -verbose %f,
      \ exiftool %c,
      \ file %c,

" Try to make a preview from the audio file
fileviewer <audio/*>
      \ vifmimg audio %px %py %pw %ph %c
      \ %pc
      \ vifmimg clear,
      \ mp3info %c,
      \ file %c,

" Try to preview the font
fileviewer <font/*>
      \ vifmimg font %px %py %pw %ph %c
      \ %pc
      \ vifmimg clear,
      \ file %c,

" Try to show the manpage with style
fileviewer {*.[1-8]},<text/troff>
      \ man %c | col -b,
      \ file %c,

" Try to show torrent information
fileviewer {*.torrent},<application/x-bittorrent>
      \ dumptorrent -v %c,
      \ file %c,

" Try to preview some compressed files
fileviewer *.zip,*.jar,*.war,*.ear,*.oxt
      \ zip -sf %c,
      \ file %c,

" Try to preview some compressed files
fileviewer {*.tar},<application/x-tar>
      \ tar -tf %c,
      \ file %c,

" Try to preview some compressed files
fileviewer *.tgz,*.tar.gz
      \ tar -tzf %c,
      \ file %c,

" Try to preview some compressed files
fileviewer *.tar.bz2,*.tbz2
      \ tar -tjf %c,
      \ file %c,

" Try to preview some compressed files
fileviewer *.tar.txz,*.txz
      \ xz --list %c,
      \ file %c,

" Try to preview some compressed files
fileviewer {*.rar},<application/x-rar>
      \ unrar v %c,
      \ file %c,

" Try to preview some compressed files
fileviewer {*.7z},<application/x-7z-compressed>
      \ 7z l %c,
      \ file %c,

" Show verbose information from every other file
fileviewer *
      \ exiftool %c,
      \ file %c,

" vim: ft=vim
